extends form-layout

block content
  h1= title
  form#formAdicionaPaciente(name="adicionaPaciente", method="post", action="#{address}")
    input#cidlist(type="hidden", value="")

    if locals._id
      input(type="hidden", name="_id", value="#{_id}")
    p Nome
      input(type="text", placeholder="Nome do paciente", name="nome", value="#{nome}")
    p Data de nascimento
      input(type="text", placeholder="Data de nascimento", name="dataNascimento" value="#{dataNascimento}")
    p Sexo
      span.radio
        input(type="radio", name="sexo", value="m", checked=sexo)
        label.radio Masculino
        input(type="radio", name="sexo", value="f", checked=!sexo)
        label.radio Feminino
    p CPF
      input(type="text", placeholder="CPF do paciente", name="cpf", value="#{cpf}")

    // Morbidades
    div#listaRegistros
      if registros
        input#numRegistros(type="hidden", value="#{registros.length}")
      else
        input#numRegistros(type="hidden", value="0")

    p
      button(onclick="") Adiciona registro
      script.
        var adicionaRegistro = function() {
          var $registros = $("input#numRegistros");
          console.log("registros = ", $registros.val());
          var num = $registros.val();
          var divId = "itemRegistro" + num;
          var $div = inputRegistro(divId);

          $("div#listaRegistro").append($div);
          $registros.val(parseInt($registros.val()) + 1);
          return false;
        }

    p EndereÃ§o
      input(type="text", placeholder="Logradouro", name="logradouro", value="#{logradouro}")
    p &nbsp;
      input(type="text", placeholder="Complemento", name="complemento" value="#{complemento}")
    p &nbsp;
      input(type="text", placeholder="Bairro", name="bairro" value="#{bairro}")
    p &nbsp;
      input(type="text", placeholder="CEP", name="cep" value="#{cep}")

    // Morbidades
    div#listaMorbidades
      if morbidades
        input#numMorbidades(type="hidden", value="#{morbidades.length}")
      else
        input#numMorbidades(type="hidden", value="0")
      each morbidade, i in morbidades
        div(id="#{'itemMorbidade' + i}")
          if i == 0
            p Morbidade principal
              input(type="text", placeholder="Morbidade", name="morbidades", value="#{morbidade}")
          else
            p Comorbidade
              input(type="text", placeholder="Comorbidade", name="morbidades", value="#{morbidade}")

    p
      button(onclick="return adicionaMorbidade();") Adicionar Morbidade
      script.
        var adicionaMorbidade = function() {
          var $morbidades = $("input#numMorbidades");
          console.log("morbidades = ", $morbidades.val());
          var num = $morbidades.val();
          var label = num > 0 ? "Comorbidade" : "Morbidade";
          var divId = "itemMorbidade" + num;
          var $div = comboCID(divId, label, "morbidades");

          $("div#listaMorbidades").append($div);
          $morbidades.val(parseInt($morbidades.val()) + 1);
          console.log("div#listaMorbidades");

          return false;
        }

    span
      button#btnSubmit.inline(type="submit") Salvar
      button.inline(onclick="window.location='/paciente/lista'; return false;") Cancelar
